<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>청소년지도사 자격증 취득 현황 대시보드</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* 공공기관 웹접근성 색 대비 명도 기준 준수 색상 */
            --primary-color: #0047AB; /* 더 진한 파란색으로 명도 대비 향상 */
            --secondary-color: #1E5BA8; /* 중간 파란색 */
            --accent-color: #4682B4; /* 밝은 파란색 */
            --light-color: #E6F0FF; /* 매우 밝은 파란색 배경 */
            --dark-color: #002855; /* 가장 진한 파란색 */
            --success-color: #2E7D32; /* 더 진한 녹색 */
            --info-color: #0277BD; /* 더 진한 정보 파란색 */
            --warning-color: #EF6C00; /* 더 진한 주황색 */
            --danger-color: #C62828; /* 더 진한 빨간색 */

            /* 텍스트 색상 - 명도 대비 7:1 이상 유지 */
            --text-primary: #212121; /* 매우 어두운 회색 */
            --text-secondary: #424242; /* 어두운 회색 */
            --text-tertiary: #616161; /* 중간 회색 */
            --text-disabled: #9E9E9E; /* 밝은 회색 */

            /* 배경 색상 */
            --bg-primary: #FFFFFF; /* 순백색 */
            --bg-secondary: #F5F7FA; /* 매우 밝은 회색 */
            --bg-tertiary: #EEEEEE; /* 밝은 회색 */

            /* 기타 변수 */
            --sidebar-width: 280px;
            --header-height: 70px;
            --card-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --font-family: 'Noto Sans KR', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --button-bg: rgba(255, 255, 255, 0.15);
            --button-active-bg: rgba(255, 255, 255, 0.3);
            --button-hover-bg: rgba(255, 255, 255, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
            padding-bottom: 60px; /* 푸터 공간 확보 */
        }

        /* 접근성: 고대비 모드 */
        body.high-contrast {
            --primary-color: #000000;
            --secondary-color: #000000;
            --accent-color: #000000;
            --light-color: #FFFFFF;
            --dark-color: #000000;
            --text-primary: #000000;
            --text-secondary: #000000;
            --text-tertiary: #000000;
            --bg-primary: #FFFFFF;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #FFFFFF;
            --button-bg: rgba(0, 0, 0, 0.8);
            --button-active-bg: rgba(0, 0, 0, 0.9);
            --button-hover-bg: rgba(0, 0, 0, 0.85);
        }

        /* 레이아웃 */
        .app-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* 사이드바 */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--bg-primary);
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
            transform: translateX(0);
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar-header i {
            font-size: 24px;
            margin-right: 10px;
            color: var(--bg-primary);
        }

        .sidebar-header h2 {
            font-size: 16px; /* 폰트 크기 조정 */
            font-weight: 600;
            color: var(--bg-primary);
            white-space: nowrap; /* 텍스트 잘림 방지 */
            overflow: hidden; /* 넘치는 텍스트 숨김 */
            text-overflow: ellipsis; /* 넘치는 텍스트에 ... 표시 */
        }

        /* 아코디언 필터 스타일 */
        .accordion-filter-section {
            margin-bottom: 15px;
        }

        .accordion-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            overflow: hidden;
            transition: var(--transition);
        }

        .accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .accordion-header:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .accordion-header:focus {
            outline: 2px solid rgba(255, 255, 255, 0.5);
            outline-offset: 2px;
        }

        .accordion-header h3 {
            font-size: 16px;
            margin: 0;
            display: flex;
            align-items: center;
            color: var(--bg-primary);
        }

        .accordion-header h3 i {
            margin-right: 8px;
            color: var(--bg-primary);
        }

        .accordion-toggle {
            transition: transform 0.3s ease;
            color: var(--bg-primary);
        }

        .accordion-item[aria-expanded="false"] .accordion-toggle {
            transform: rotate(-90deg);
        }

        .accordion-content {
            max-height: 1000px; /* 충분히 늘려서 내용이 잘리지 않도록 함 */
            overflow-y: auto; /* 내용이 넘칠 경우 스크롤바 생성 */
            transition: max-height 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                        padding 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        opacity 0.3s ease;
            padding: 0 15px 15px 15px;
            opacity: 1;
        }

        .accordion-item[aria-expanded="false"] .accordion-content {
            max-height: 0;
            padding: 0 15px;
            opacity: 0;
        }

        /* 버튼 그룹 스타일 - 중복 선택 가능 */
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .filter-btn.select-all-btn {
            flex: 0 0 100%; /* 전체 선택 버튼은 항상 한 줄에 하나씩 */
            max-width: 100%;
            margin-bottom: 8px; /* 아래 버튼들과 간격 */
        }

        .filter-buttons-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .year-filter-buttons-container .filter-btn {
            flex: 0 0 calc(33.33% - 8px); /* 한 줄에 3개씩 배치 (gap 고려) */
            max-width: calc(33.33% - 8px);
        }

        .filter-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: var(--button-bg);
            color: var(--bg-primary);
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            opacity: 1;
            transform: scale(1);
        }

        .filter-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .filter-btn:hover::before {
            transform: translateX(0);
        }

        .filter-btn:hover {
            background: var(--button-hover-bg);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .filter-btn.active {
            background: var(--button-active-bg);
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .filter-btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5);
        }

        /* 필터 액션 버튼 2x2 레이아웃 */
        .filter-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap; /* 텍스트 잘림 방지 */
        }

        .btn-primary {
            background: rgba(255, 255, 255, 0.2);
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--bg-primary);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }



        /* 메인 콘텐츠 */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            transition: var(--transition);
            opacity: 1;
            transform: translateX(0);
        }

        /* 헤더 */
        .header {
            background: var(--bg-primary);
            border-radius: var(--card-radius);
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: var(--header-height);
            transition: var(--transition);
            opacity: 1;
            transform: translateY(0);
        }

        .header:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .header h1 {
            font-size: 24px;
            color: var(--primary-color);
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn-export {
            background: var(--primary-color);
            color: var(--bg-primary);
            padding: 10px 20px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: var(--transition);
            border: none;
            cursor: pointer;
        }

        .btn-export:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* 필터 결과 표시 */
        .filter-results {
            background: var(--bg-primary);
            border-radius: var(--card-radius);
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: flex-start; /* 왼쪽 정렬 */
            align-items: center;
            gap: 15px; /* 텍스트와 숫자 사이 간격 */
            transition: var(--transition);
            opacity: 1;
            transform: translateY(0);
        }

        .filter-results:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }

        .filter-text {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .filter-count {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        /* 통계 카드 */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-primary);
            border-radius: var(--card-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
            opacity: 1;
            transform: translateY(0);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            opacity: 0.1;
            z-index: 0;
            transition: var(--transition);
        }

        .stat-card:hover::before {
            transform: scale(1.2);
        }

        .stat-card.blue::before {
            background: var(--info-color);
        }

        .stat-card.pink::before {
            background: var(--danger-color);
        }

        .stat-card.sky::before {
            background: #0288D1; /* 더 진한 하늘색 */
        }

        .stat-card.purple::before {
            background: #7B1FA2; /* 더 진한 보라색 */
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            z-index: 1;
        }

        .stat-title {
            font-size: 14px;
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-primary);
            transition: var(--transition);
        }

        .stat-card:hover .stat-icon {
            transform: rotate(15deg) scale(1.1);
        }

        .stat-card.blue .stat-icon {
            background: var(--info-color);
        }

        .stat-card.pink .stat-icon {
            background: var(--danger-color);
        }

        .stat-card.sky .stat-icon {
            background: #0288D1;
        }

        .stat-card.purple .stat-icon {
            background: #7B1FA2;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
            z-index: 1;
            transition: var(--transition);
        }

        .stat-card:hover .stat-value {
            transform: scale(1.05);
        }

        .stat-card.blue .stat-value {
            color: var(--info-color);
        }

        .stat-card.pink .stat-value {
            color: var(--danger-color);
        }

        .stat-card.sky .stat-value {
            color: #0288D1;
        }

        .stat-card.purple .stat-value {
            color: #7B1FA2;
        }

        .stat-desc {
            font-size: 14px;
            color: var(--text-tertiary);
            z-index: 1;
        }

        .stat-change {
            display: flex;
            align-items: center;
            font-size: 14px;
            margin-top: 10px;
            z-index: 1;
            transition: var(--transition);
        }

        .stat-change.positive {
            color: var(--success-color);
        }

        .stat-change.negative {
            color: var(--danger-color);
        }

        .stat-change i {
            margin-right: 5px;
        }

        /* 차트 컨테이너 */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr; /* 연도별 차트만 크게 */
            gap: 25px;
            margin-bottom: 30px;
        }

        .charts-container.secondary-charts {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* 나머지 3개 차트 가로 배치 */
        }

        .chart-card {
            background: var(--bg-primary);
            border-radius: var(--card-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            opacity: 1;
            transform: translateY(0);
        }

        .chart-card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-actions select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--bg-tertiary);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .chart-actions select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .chart-description {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 15px;
            line-height: 1.5;
        }

        /* 로딩 오버레이 */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 최근 취득자 현황 */
        .recent-acquisitions {
            background: var(--bg-primary);
            border-radius: var(--card-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .recent-acquisitions:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }

        .recent-acquisitions h2 {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .recent-list {
            list-style: none;
            padding: 0;
        }

        .recent-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--bg-tertiary);
            font-size: 15px;
            color: var(--text-secondary);
        }

        .recent-item:last-child {
            border-bottom: none;
        }

        .recent-item span:first-child {
            font-weight: 500;
            color: var(--text-primary);
        }

        /* 반응형 디자인 */
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
            .charts-container.secondary-charts {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                transform: translateX(-100%); /* 기본적으로 숨김 */
            }

            .sidebar.active {
                transform: translateX(0); /* 활성화 시 보임 */
            }

            .main-content {
                margin-left: 0;
                padding: 15px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                height: auto;
                padding: 15px;
            }

            .header h1 {
                margin-bottom: 10px;
            }

            .header-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .filter-results {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-count {
                margin-top: 10px;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .sidebar-toggle-btn {
                display: block; /* 모바일에서 토글 버튼 표시 */
            }

            .filter-actions {
                grid-template-columns: 1fr; /* 모바일에서 1열로 변경 */
            }
        }

        /* 사이드바 토글 버튼 (모바일용) */
        .sidebar-toggle-btn {
            display: none; /* 기본적으로 숨김 */
            position: fixed;
            top: 15px;
            left: 15px;
            background: var(--primary-color);
            color: var(--bg-primary);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1001;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .sidebar-toggle-btn:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }

        /* 고대비 모드 토글 버튼 */
        .contrast-toggle-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--dark-color);
            color: var(--bg-primary);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 22px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .contrast-toggle-btn:hover {
            background: var(--primary-color);
            transform: scale(1.05);
        }

        /* 움직임 감소 모드 */
        body.reduce-motion * {
            transition: none !important;
            animation: none !important;
        }

        /* 현재 선택된 필터 표시 영역 */
        .current-filters-display {
            background: var(--bg-primary);
            border-radius: var(--card-radius);
            padding: 15px 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            min-height: 60px; /* 최소 높이 설정 */
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            transition: var(--transition);
        }

        .filter-tag {
            display: inline-flex;
            align-items: center;
            background-color: var(--primary-color);
            color: var(--bg-primary);
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        .filter-tag .remove-tag {
            margin-left: 8px;
            background: none;
            border: none;
            color: var(--bg-primary);
            font-size: 14px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            transition: transform 0.2s ease;
        }

        .filter-tag .remove-tag:hover {
            transform: scale(1.2);
        }

        .filter-tag .remove-tag:focus {
            outline: 2px solid var(--bg-primary);
            outline-offset: 2px;
        }

    </style>
</head>
<body>
    <button class="sidebar-toggle-btn" aria-label="사이드바 토글">
        <i class="fas fa-bars"></i>
    </button>
    <div class="app-container">
        <aside class="sidebar" aria-label="대시보드 필터">
            <div class="sidebar-header">
                <i class="fas fa-chart-bar"></i>
                <h2>대시보드 필터</h2>
            </div>

            <div class="accordion-filter-section">
                <div class="accordion-item" id="year-filter-accordion">
                    <button class="accordion-header" aria-expanded="false" aria-controls="year-filter-content">
                        <h3><i class="fas fa-calendar-alt"></i> 연도</h3>
                        <i class="fas fa-chevron-down accordion-toggle"></i>
                    </button>
                    <div class="accordion-content" id="year-filter-content">
                        <div class="button-group year-filter-group" id="year-filter-buttons"></div>
                    </div>
                </div>

                <div class="accordion-item" id="grade-filter-accordion">
                    <button class="accordion-header" aria-expanded="false" aria-controls="grade-filter-content">
                        <h3><i class="fas fa-graduation-cap"></i> 급수</h3>
                        <i class="fas fa-chevron-down accordion-toggle"></i>
                    </button>
                    <div class="accordion-content" id="grade-filter-content">
                        <div class="button-group" id="grade-filter-buttons"></div>
                    </div>
                </div>

                <div class="accordion-item" id="age-filter-accordion">
                    <button class="accordion-header" aria-expanded="false" aria-controls="age-filter-content">
                        <h3><i class="fas fa-user-friends"></i> 연령대</h3>
                        <i class="fas fa-chevron-down accordion-toggle"></i>
                    </button>
                    <div class="accordion-content" id="age-filter-content">
                        <div class="button-group" id="age-filter-buttons"></div>
                    </div>
                </div>

                <div class="accordion-item" id="gender-filter-accordion">
                    <button class="accordion-header" aria-expanded="false" aria-controls="gender-filter-content">
                        <h3><i class="fas fa-venus-mars"></i> 성별</h3>
                        <i class="fas fa-chevron-down accordion-toggle"></i>
                    </button>
                    <div class="accordion-content" id="gender-filter-content">
                        <div class="button-group" id="gender-filter-buttons"></div>
                    </div>
                </div>

                <div class="accordion-item" id="region-filter-accordion">
                    <button class="accordion-header" aria-expanded="false" aria-controls="region-filter-content">
                        <h3><i class="fas fa-map-marker-alt"></i> 지역</h3>
                        <i class="fas fa-chevron-down accordion-toggle"></i>
                    </button>
                    <div class="accordion-content" id="region-filter-content">
                        <div class="button-group" id="region-filter-buttons"></div>
                    </div>
                </div>
            </div>

            <div class="filter-actions">
                <button class="btn btn-primary" id="reset-filters-btn" aria-label="필터 초기화">
                    <i class="fas fa-sync-alt"></i> 초기화
                </button>
                <button class="btn btn-secondary" id="save-filters-btn" aria-label="필터 저장">
                    <i class="fas fa-save"></i> 저장
                </button>
                <button class="btn btn-secondary" id="load-filters-btn" aria-label="필터 불러오기">
                    <i class="fas fa-upload"></i> 불러오기
                </button>
                <button class="btn btn-primary" id="apply-filters-btn" aria-label="필터 적용">
                    <i class="fas fa-check-circle"></i> 적용
                </button>
            </div>

            <button class="btn btn-admin" id="admin-login-btn" aria-label="관리자 로그인">
                <i class="fas fa-user-shield"></i> 관리자 로그인
            </button>
        </aside>

        <main class="main-content" role="main" aria-label="대시보드 주요 콘텐츠">
            <header class="header" role="banner">
                <h1>청소년지도사 자격증 취득 현황</h1>
                <div class="header-actions">
                    <button class="btn-export" id="export-data-btn" aria-label="데이터 내보내기">
                        <i class="fas fa-file-excel"></i> 데이터 내보내기
                    </button>
                </div>
            </header>

            <section class="filter-results" aria-live="polite" aria-atomic="true">
                <span class="filter-text">총 검색된 데이터:</span>
                <span class="filter-count" id="total-data-count">75,892건</span>
            </section>

            <section class="current-filters-display" aria-live="polite" aria-atomic="true" id="current-filters-display">
                <!-- 선택된 필터 태그들이 여기에 동적으로 추가됩니다 -->
                <span style="color: var(--text-tertiary);">현재 선택된 필터 없음</span>
            </section>

            <section class="stats-container" aria-label="주요 통계 요약">
                <div class="stat-card blue">
                    <div class="stat-header">
                        <span class="stat-title">총 발급 건수</span>
                        <div class="stat-icon"><i class="fas fa-certificate"></i></div>
                    </div>
                    <div class="stat-value" id="total-issued-count">75,892</div>
                    <span class="stat-desc">1993년 이후 누적</span>
                    <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 1.2% (전년 대비)</div>
                </div>

                <div class="stat-card pink">
                    <div class="stat-header">
                        <span class="stat-title">평균 연령</span>
                        <div class="stat-icon"><i class="fas fa-user"></i></div>
                    </div>
                    <div class="stat-value" id="average-age">32.5세</div>
                    <span class="stat-desc">현재 필터 기준</span>
                    <div class="stat-change negative"><i class="fas fa-arrow-down"></i> 0.3세 (전년 대비)</div>
                </div>

                <div class="stat-card sky">
                    <div class="stat-header">
                        <span class="stat-title">남성 비율</span>
                        <div class="stat-icon"><i class="fas fa-male"></i></div>
                    </div>
                    <div class="stat-value" id="male-ratio">45.2%</div>
                    <span class="stat-desc">현재 필터 기준</span>
                    <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 0.5% (전년 대비)</div>
                </div>

                <div class="stat-card purple">
                    <div class="stat-header">
                        <span class="stat-title">여성 비율</span>
                        <div class="stat-icon"><i class="fas fa-female"></i></div>
                    </div>
                    <div class="stat-value" id="female-ratio">54.8%</div>
                    <span class="stat-desc">현재 필터 기준</span>
                    <div class="stat-change negative"><i class="fas fa-arrow-down"></i> 0.5% (전년 대비)</div>
                </div>
            </section>

            <section class="charts-container" aria-label="데이터 시각화 차트">
                <div class="chart-card" role="img" aria-label="연도별 취득 추이 차트">
                    <div class="chart-header">
                        <h2 class="chart-title">연도별 취득 추이</h2>
                        <div class="chart-actions">
                            <label for="year-chart-type" class="sr-only">그래프 유형:</label>
                            <select id="year-chart-type" class="chart-type-selector">
                                <option value="bar">막대 그래프</option>
                                <option value="line">선 그래프</option>
                                <option value="area">영역 그래프</option>
                            </select>
                        </div>
                    </div>
                    <div style="position: relative; height:400px; width:100%;">
                        <canvas id="yearChart"></canvas>
                        <div class="loading-overlay" id="yearChartLoading"><div class="spinner"></div></div>
                    </div>
                    <p class="chart-description">1993년부터 현재까지 연도별 청소년지도사 자격증 취득 건수의 변화를 보여주는 차트입니다.</p>
                </div>
            </section>

            <section class="charts-container secondary-charts" aria-label="보조 데이터 시각화 차트">
                <div class="chart-card" role="img" aria-label="급수별 현황 차트">
                    <div class="chart-header">
                        <h2 class="chart-title">급수별 현황</h2>
                        <div class="chart-actions">
                            <label for="grade-chart-type" class="sr-only">그래프 유형:</label>
                            <select id="grade-chart-type" class="chart-type-selector">
                                <option value="pie">파이 차트</option>
                                <option value="doughnut">도넛 차트</option>
                                <option value="bar">막대 그래프</option>
                            </select>
                        </div>
                    </div>
                    <div style="position: relative; height:400px; width:100%;">
                        <canvas id="gradeChart"></canvas>
                        <div class="loading-overlay" id="gradeChartLoading"><div class="spinner"></div></div>
                    </div>
                    <p class="chart-description">1급, 2급, 3급별 청소년지도사 자격증 취득 비율을 보여주는 차트입니다.</p>
                </div>

                <div class="chart-card" role="img" aria-label="지역별 현황 차트">
                    <div class="chart-header">
                        <h2 class="chart-title">지역별 현황</h2>
                        <div class="chart-actions">
                            <label for="region-chart-type" class="sr-only">그래프 유형:</label>
                            <select id="region-chart-type" class="chart-type-selector">
                                <option value="bar">막대 그래프</option>
                                <option value="pie">파이 차트</option>
                                <option value="doughnut">도넛 차트</option>
                            </select>
                        </div>
                    </div>
                    <div style="position: relative; height:400px; width:100%;">
                        <canvas id="regionChart"></canvas>
                        <div class="loading-overlay" id="regionChartLoading"><div class="spinner"></div></div>
                    </div>
                    <p class="chart-description">전국 각 지역별 청소년지도사 자격증 취득 현황을 보여주는 차트입니다.</p>
                </div>

                <div class="chart-card" role="img" aria-label="성별 및 연령대별 현황 차트">
                    <div class="chart-header">
                        <h2 class="chart-title">성별 및 연령대별 현황</h2>
                        <div class="chart-actions">
                            <label for="gender-age-chart-type" class="sr-only">그래프 유형:</label>
                            <select id="gender-age-chart-type" class="chart-type-selector">
                                <option value="bar">막대 그래프</option>
                                <option value="radar">레이더 그래프</option>
                            </select>
                        </div>
                    </div>
                    <div style="position: relative; height:400px; width:100%;">
                        <canvas id="genderAgeChart"></canvas>
                        <div class="loading-overlay" id="genderAgeChartLoading"><div class="spinner"></div></div>
                    </div>
                    <p class="chart-description">성별과 연령대별 청소년지도사 자격증 취득 현황을 보여주는 차트입니다.</p>
                </div>
            </section>

            <section class="recent-acquisitions" aria-label="최근 취득자 현황">
                <h2>최근 취득자 현황</h2>
                <ul class="recent-list" id="recent-acquisitions-list">
                    <!-- 최근 취득자 데이터가 여기에 동적으로 로드됩니다 -->
                </ul>
            </section>
        </main>
    </div>

    <button class="contrast-toggle-btn" aria-label="고대비 모드 토글">
        <i class="fas fa-adjust"></i>
    </button>

    <script>
        let allData = [];
        let yearChart, gradeChart, regionChart, genderAgeChart;
        let selectedFilters = {
            '연도': [],
            '급수': [],
            '연령대': [],
            '성별': [],
            '지역': []
        };

        const chartConfigs = {
            yearChart: {
                chart: null,
                type: 'bar',
                ctx: 'yearChart',
                loadingId: 'yearChartLoading',
                title: '연도별 취득 추이',
                description: '1993년부터 현재까지 연도별 청소년지도사 자격증 취득 건수의 변화를 보여주는 차트입니다.'
            },
            gradeChart: {
                chart: null,
                type: 'pie',
                ctx: 'gradeChart',
                loadingId: 'gradeChartLoading',
                title: '급수별 현황',
                description: '1급, 2급, 3급별 청소년지도사 자격증 취득 비율을 보여주는 차트입니다.'
            },
            regionChart: {
                chart: null,
                type: 'bar',
                ctx: 'regionChart',
                loadingId: 'regionChartLoading',
                title: '지역별 현황',
                description: '전국 각 지역별 청소년지도사 자격증 취득 현황을 보여주는 차트입니다.'
            },
            genderAgeChart: {
                chart: null,
                type: 'bar',
                ctx: 'genderAgeChart',
                loadingId: 'genderAgeChartLoading',
                title: '성별 및 연령대별 현황',
                description: '성별과 연령대별 청소년지도사 자격증 취득 현황을 보여주는 차트입니다.'
            }
        };

        // 데이터 로드
        async function loadData() {
            try {
                const response = await fetch("dashboard_data.json");
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                allData = await response.json();
                console.log("Data loaded successfully:", allData);
                initializeDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                alert('데이터를 불러오는 데 실패했습니다. 파일을 확인해주세요.');
            }
        }

        function initializeDashboard() {
            initializeFilters();
            initializeAccordion();
            updateDashboard();
        }

        document.addEventListener("DOMContentLoaded", function() {
            loadData();
        });
        }

        function hideLoading(chartId) {
            document.getElementById(chartId).classList.remove('active');
        }

        // 대시보드 업데이트
        function updateDashboard() {
            const filteredData = applyFilters(allData);
            initializeFilters(); // 필터 버튼을 데이터 필터링 후에        function updateDashboard(filteredData) {
            updateStatCards(filteredData);
            updateCharts(filteredData);
            updateFilterResult(filteredData);
        }      // 필터 적용 로직
        function applyFilters(data) {
            // 데이터 필드명 매핑
            const fieldMapping = {
                '연도': '년도',
                '급수': ' 급수',
                '연령대': '연령대',
                '성별': '성별',
                '지역': '지역'
            };

            return data.filter(item => {
                for (const category in selectedFilters) {
                    const filterValues = selectedFilters[category];
                    if (filterValues.length > 0) {
                        const fieldName = fieldMapping[category];
                        if (!filterValues.includes(item[fieldName])) {
                            return false;
                        }
                    }
                }
                return true;
            });
        }

        // 요약 통계 업데이트
        function updateSummaryStats(data) {
            document.getElementById('total-issued-count').textContent = data.length.toLocaleString();

            const ages = data.map(item => {
                const ageRange = item['연령대'];
                if (ageRange) {
                    const match = ageRange.match(/(\d+)대/);
                    if (match) {
                        return parseInt(match[1]) + 5; // 연령대 중앙값 사용 (예: 20대 -> 25세)
                    }
                }
                return null;
            }).filter(age => age !== null);

            const averageAge = ages.length > 0 ? (ages.reduce((sum, age) => sum + age, 0) / ages.length).toFixed(1) : 'N/A';
            document.getElementById('average-age').textContent = `${averageAge}세`;

            const maleCount = data.filter(item => item['성별'] === '남').length;
            const femaleCount = data.filter(item => item['성별'] === '여').length;
            const totalGendered = maleCount + femaleCount;

            const maleRatio = totalGendered > 0 ? ((maleCount / totalGendered) * 100).toFixed(1) : 'N/A';
            const femaleRatio = totalGendered > 0 ? ((femaleCount / totalGendered) * 100).toFixed(1) : 'N/A';

            document.getElementById('male-ratio').textContent = `${maleRatio}%`;
            document.getElementById('female-ratio').textContent = `${femaleRatio}%`;

            // 전년 대비 증감률 (임시 데이터, 실제 데이터 필요)
            // 이 부분은 실제 데이터가 없으므로 임시로 텍스트만 업데이트
            // 실제 구현 시에는 전년도 데이터와 비교하여 계산해야 합니다.
            const totalIssuedCountElement = document.getElementById('total-issued-count');
            const averageAgeElement = document.getElementById('average-age');
            const maleRatioElement = document.getElementById('male-ratio');
            const femaleRatioElement = document.getElementById('female-ratio');

            // 임시로 이전 값과의 변화를 시뮬레이션
            const prevTotal = 75000; // 예시
            const prevAge = 32.8; // 예시
            const prevMaleRatio = 44.7; // 예시
            const prevFemaleRatio = 55.3; // 예시

            updateChangeIndicator(totalIssuedCountElement.nextElementSibling, data.length, prevTotal);
            updateChangeIndicator(averageAgeElement.nextElementSibling, parseFloat(averageAge), prevAge, true);
            updateChangeIndicator(maleRatioElement.nextElementSibling, parseFloat(maleRatio), prevMaleRatio);
            updateChangeIndicator(femaleRatioElement.nextElementSibling, parseFloat(femaleRatio), prevFemaleRatio, true);
        }

        function updateChangeIndicator(element, current, previous, isNegativeGood = false) {
            if (isNaN(current) || isNaN(previous)) {
                element.style.display = 'none';
                return;
            }
            element.style.display = 'flex';
            const diff = current - previous;
            const percentChange = (diff / previous) * 100;

            element.classList.remove('positive', 'negative');
            let iconClass = '';
            let changeText = '';

            if (diff > 0) {
                element.classList.add(isNegativeGood ? 'negative' : 'positive');
                iconClass = isNegativeGood ? 'fas fa-arrow-down' : 'fas fa-arrow-up';
                changeText = `↑ ${Math.abs(percentChange).toFixed(1)}%`;
            } else if (diff < 0) {
                element.classList.add(isNegativeGood ? 'positive' : 'negative');
                iconClass = isNegativeGood ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                changeText = `↓ ${Math.abs(percentChange).toFixed(1)}%`;
            } else {
                iconClass = 'fas fa-minus';
                changeText = '변동 없음';
            }

            element.innerHTML = `<i class="${iconClass}"></i> ${changeText} (전년 대비)`;
        }

        // 차트 업데이트
        function updateCharts(data) {
            updateYearChart(data);
            updateGradeChart(data);
            updateRegionChart(data);
            updateGenderAgeChart(data);
        }

        // 연도별 차트
        function updateYearChart(data) {
            showLoading(chartConfigs.yearChart.loadingId);
            const yearCounts = {};
            data.forEach(item => {
                const year = item['년도'];
                yearCounts[year] = (yearCounts[year] || 0) + 1;
            });

            const labels = Object.keys(yearCounts).sort((a, b) => b - a); // 내림차순 정렬
            const counts = labels.map(year => yearCounts[year]);

            if (yearChart) {
                yearChart.destroy();
            }

            const ctx = document.getElementById(chartConfigs.yearChart.ctx).getContext('2d');
            yearChart = new Chart(ctx, {
                type: chartConfigs.yearChart.type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: '발급 건수',
                        data: counts,
                        backgroundColor: 'rgba(0, 71, 171, 0.8)',
                        borderColor: 'rgba(0, 71, 171, 1)',
                        borderWidth: 1,
                        fill: chartConfigs.yearChart.type === 'area' // 영역 그래프일 때만 채우기
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.raw.toLocaleString() + '건';
                                    return label;
                                }
                            }
                        },
                        datalabels: {
                            display: false // 기본적으로 숨김
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '연도'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '건수'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            hideLoading(chartConfigs.yearChart.loadingId);
        }

        // 급수별 차트
        function updateGradeChart(data) {
            showLoading(chartConfigs.gradeChart.loadingId);
            const gradeCounts = {};
            data.forEach(item => {
               const grade = item["급수"];
                gradeCounts[grade] = (gradeCounts[grade] || 0) + 1;
            });

            const labels = Object.keys(gradeCounts).sort();
            const counts = labels.map(grade => gradeCounts[grade]);

            if (gradeChart) {
                gradeChart.destroy();
            }

            const ctx = document.getElementById(chartConfigs.gradeChart.ctx).getContext('2d');
            gradeChart = new Chart(ctx, {
                type: chartConfigs.gradeChart.type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: '발급 건수',
                        data: counts,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed.toLocaleString() + '건';
                                        const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        label += ` (${percentage}%)`;
                                    }
                                    return label;
                                }
                            }
                        },
                        datalabels: {
                            color: '#fff',
                            formatter: (value, context) => {
                                const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return percentage + '%';
                            }
                        }
                    }
                }
            });
            hideLoading(chartConfigs.gradeChart.loadingId);
        }

        // 지역별 차트
        function updateRegionChart(data) {
            showLoading(chartConfigs.regionChart.loadingId);
            const regionCounts = {};
            data.forEach(item => {
                const region = item['지역'];
                regionCounts[region] = (regionCounts[region] || 0) + 1;
            });

            const labels = Object.keys(regionCounts).sort();
            const counts = labels.map(region => regionCounts[region]);

            if (regionChart) {
                regionChart.destroy();
            }

            const ctx = document.getElementById(chartConfigs.regionChart.ctx).getContext('2d');
            regionChart = new Chart(ctx, {
                type: chartConfigs.regionChart.type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: '발급 건수',
                        data: counts,
                        backgroundColor: 'rgba(75, 192, 192, 0.8)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed.toLocaleString() + '건';
                                        if (chartConfigs.regionChart.type !== 'bar') {
                                            const total = context.dataset.data.reduce((sum, val) => sum + val, 0);
                                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                                            label += ` (${percentage}%)`;
                                        }
                                    }
                                    return label;
                                }
                            }
                        },
                        datalabels: {
                            display: false // 기본적으로 숨김
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '지역'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '건수'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            hideLoading(chartConfigs.regionChart.loadingId);
        }

        // 성별 및 연령대별 차트
        function updateGenderAgeChart(data) {
            showLoading(chartConfigs.genderAgeChart.loadingId);
            const genderAgeCounts = {};
            data.forEach(item => {
                const gender = item['성별'];
                const age = item['연령대'];
                const key = `${gender}-${age}`;
                genderAgeCounts[key] = (genderAgeCounts[key] || 0) + 1;
            });

            const labels = Object.keys(genderAgeCounts).sort();
            const counts = labels.map(key => genderAgeCounts[key]);

            if (genderAgeChart) {
                genderAgeChart.destroy();
            }

            const ctx = document.getElementById(chartConfigs.genderAgeChart.ctx).getContext('2d');
            genderAgeChart = new Chart(ctx, {
                type: chartConfigs.genderAgeChart.type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: '발급 건수',
                        data: counts,
                        backgroundColor: 'rgba(153, 102, 255, 0.8)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.raw.toLocaleString() + '건';
                                    return label;
                                }
                            }
                        },
                        datalabels: {
                            display: false // 기본적으로 숨김
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '성별-연령대'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '건수'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            hideLoading(chartConfigs.genderAgeChart.loadingId);
        }

        // 최근 취득자 현황 업데이트
        function updateRecentAcquisitions(data) {
            const recentList = document.getElementById('recent-acquisitions-list');
            recentList.innerHTML = ''; // 기존 목록 초기화

            // 발급일자를 기준으로 최신순으로 정렬
            const sortedData = [...data].sort((a, b) => {
                const dateA = new Date(a['발급일자']);
                const dateB = new Date(b['발급일자']);
                return dateB - dateA;
            });

            // 상위 10개만 표시
            sortedData.slice(0, 10).forEach(item => {
                const listItem = document.createElement('li');
                listItem.classList.add('recent-item');
                listItem.innerHTML = `
                    <span>${item['성명']} (${item['성별']}, ${item['연령대']})</span>
                    <span>${item['지역']} - ${item['발급일자']}</span>
                `;
                recentList.appendChild(listItem);
            });
        }

        // 총 데이터 카운트 업데이트
        function updateFilterCount(count) {
            document.getElementById('total-data-count').textContent = `${count.toLocaleString()}건`;
        }

        // 필터 초기화
        document.getElementById('reset-filters-btn').addEventListener('click', () => {
            selectedFilters = {
                '연도': [],
                '급수': [],
                '연령대': [],
                '성별': [],
                '지역': []
            };
            document.querySelectorAll('.filter-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            updateDashboard();
            updateCurrentFiltersDisplay();
        });

        // 필터 저장 (로컬 스토리지 사용)
        document.getElementById('save-filters-btn').addEventListener('click', () => {
            localStorage.setItem('savedFilters', JSON.stringify(selectedFilters));
            alert('현재 필터가 저장되었습니다!');
        });

        // 필터 불러오기 (로컬 스토리지 사용)
        document.getElementById('load-filters-btn').addEventListener('click', () => {
            const savedFilters = localStorage.getItem('savedFilters');
            if (savedFilters) {
                selectedFilters = JSON.parse(savedFilters);
                // UI 업데이트
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                for (const category in selectedFilters) {
                    selectedFilters[category].forEach(value => {
                        const btn = document.querySelector(`.filter-btn[data-category="${category}"][data-value="${value}"]`);
                        if (btn) {
                            btn.classList.add('active');
                        }
                    });
                }
                updateDashboard();
                updateCurrentFiltersDisplay();
                alert('저장된 필터를 불러왔습니다!');
            } else {
                alert('저장된 필터가 없습니다.');
            }
        });

        // 필터 적용 버튼 (현재는 필터 선택 시 바로 적용되므로, 이 버튼은 추가적인 기능이 필요할 때 사용)
        document.getElementById('apply-filters-btn').addEventListener('click', () => {
            updateDashboard();
            alert('필터가 적용되었습니다!');
        });

        // 현재 선택된 필터 표시 업데이트
        function updateCurrentFiltersDisplay() {
            const displayArea = document.getElementById('current-filters-display');
            displayArea.innerHTML = '';
            let hasActiveFilters = false;

            // 각 필터 카테고리에 대한 고유 값 추출 및 버튼 생성
            const categories = {
                '연도': 'year-filter-buttons',
                '급수': 'grade-filter-buttons',
                '연령대': 'age-filter-buttons',
                '성별': 'gender-filter-buttons',
                '지역': 'region-filter-buttons'
            };

            // 데이터 필드명 매핑 (실제 JSON 필드명과 표시명 매핑)
            const fieldMapping = {
                '연도': '년도',
                '급수': ' 급수', // 공백 포함 필드명
                '연령대': '연령대',
                '성별': '성별',
                '지역': '지역'
            };

            for (const category in selectedFilters) {
                selectedFilters[category].forEach(value => {
                    hasActiveFilters = true;
                    const filterTag = document.createElement('span');
                    filterTag.classList.add('filter-tag');
                    filterTag.innerHTML = `
                        ${category}: ${value} <button class="remove-tag" data-category="${category}" data-value="${value}" aria-label="${category} ${value} 필터 제거">&times;</button>
                    `;
                    displayArea.appendChild(filterTag);
                });
            }

            if (!hasActiveFilters) {
                displayArea.innerHTML = '<span style="color: var(--text-tertiary);">현재 선택된 필터 없음</span>';
            }

            // 태그 제거 이벤트 리스너
            displayArea.querySelectorAll('.remove-tag').forEach(button => {
                button.addEventListener('click', (event) => {
                    const category = event.target.dataset.category;
                    const value = event.target.dataset.value;
                    selectedFilters[category] = selectedFilters[category].filter(item => item !== value);
                    
                    // 해당 필터 버튼의 active 클래스 제거
                    const filterBtn = document.querySelector(`.filter-btn[data-category="${category}"][data-value="${value}"]`);
                    if (filterBtn) {
                        filterBtn.classList.remove("active");
                        filterBtn.setAttribute("aria-checked", "false");
                    }

                    // '전체 선택' 버튼 상태 업데이트
                    const buttonGroup = document.getElementById(categories[category]);
                    if (buttonGroup) {
                        const selectAllButton = buttonGroup.querySelector(".select-all-btn");
                        if (selectAllButton) {
                            const uniqueValues = [...new Set(allData.map(item => item[fieldMapping[category]]))].filter(Boolean);
                            const allIndividualSelected = uniqueValues.every(val => selectedFilters[category].includes(val));
                            selectAllButton.classList.toggle("active", allIndividualSelected);
                            selectAllButton.setAttribute("aria-checked", allIndividualSelected);
                        }
                    }

                    updateDashboard();
                    updateCurrentFiltersDisplay();
                });
            });
        }

        // 필터 버튼 동적 생성 및 이벤트 리스너
        function initializeFilters() {
            // 각 필터 카테고리에 대한 고유 값 추출 및 버튼 생성
            const categories = {
                '연도': 'year-filter-buttons',
                '급수': 'grade-filter-buttons',
                '연령대': 'age-filter-buttons',
                '성별': 'gender-filter-buttons',
                '지역': 'region-filter-buttons'
            };

            // 데이터 필드명 매핑 (실제 JSON 필드명과 표시명 매핑)
            const fieldMapping = {
                '연도': '년도',
                '급수': ' 급수', // 공백이 포함된 필드명
                '연령대': '연령대',
                '성별': '성별',
                '지역': '지역'
            };

            for (const category in categories) {
                const buttonGroup = document.getElementById(categories[category]);
                if (!buttonGroup) continue; // 요소가 없으면 건너뛰기
                
                buttonGroup.innerHTML = ''; // 기존 내용 초기화

                const selectAllButton = document.createElement('button');
                selectAllButton.classList.add('filter-btn', 'select-all-btn');
                selectAllButton.textContent = '전체 선택';
                selectAllButton.dataset.category = category;
                selectAllButton.dataset.value = 'all';
                selectAllButton.setAttribute('role', 'checkbox');
                selectAllButton.setAttribute('aria-checked', 'false');
                buttonGroup.appendChild(selectAllButton);

                const fieldName = fieldMapping[category];
                let uniqueValues = [...new Set(allData.map(item => item[fieldName]))].filter(Boolean);

                // '급수'는 1급, 2급, 3급 순서로 정렬
                if (category === '급수') {
                    uniqueValues.sort((a, b) => {
                        const gradeOrder = {'1급': 1, '2급': 2, '3급': 3};
                        return gradeOrder[a] - gradeOrder[b];
                    });
                }
                // '연도'는 내림차순 정렬
                else if (category === '연도') {
                    uniqueValues.sort((a, b) => b - a);
                }
                // '연령대'는 숫자 기준으로 정렬
                else if (category === '연령대') {
                    uniqueValues.sort((a, b) => {
                        const ageA = parseInt(a.replace('대', ''));
                        const ageB = parseInt(b.replace('대', ''));
                        return ageA - ageB;
                    });
                }
                // '지역'은 '지역 정보 없음'을 마지막으로
                else if (category === '지역') {
                    uniqueValues.sort((a, b) => {
                        if (a === '지역 정보 없음') return 1;
                        if (b === '지역 정보 없음') return -1;
                        return a.localeCompare(b);
                    });
                }

                const filterButtonsContainer = document.createElement('div');
                filterButtonsContainer.classList.add('filter-buttons-container');
                if (category === '연도') {
                    filterButtonsContainer.classList.add('year-filter-buttons-container');
                }
                buttonGroup.appendChild(filterButtonsContainer);

                uniqueValues.forEach(value => {
                    const button = document.createElement('button');
                    button.classList.add('filter-btn');
                    button.textContent = value;
                    button.dataset.category = category;
                    button.dataset.value = value;
                    button.setAttribute('role', 'checkbox');
                    button.setAttribute('aria-checked', 'false');

                    // 이전에 선택된 필터가 있으면 active 클래스 추가
                    if (selectedFilters[category].includes(value)) {
                        button.classList.add('active');
                        button.setAttribute('aria-checked', 'true');
                    }

                    button.addEventListener('click', () => {
                        const selectAllButton = buttonGroup.querySelector('.select-all-btn');
                        if (button.dataset.value === 'all') { // '전체 선택' 버튼 클릭 시
                            const isSelectAllActive = selectAllButton.classList.contains('active');
                            selectedFilters[category] = [];
                            filterButtonsContainer.querySelectorAll('.filter-btn:not(.select-all-btn)').forEach(btn => {
                                if (!isSelectAllActive) {
                                    btn.classList.add('active');
                                    btn.setAttribute('aria-checked', 'true');
                                    selectedFilters[category].push(btn.dataset.value);
                                } else {
                                    btn.classList.remove('active');
                                    btn.setAttribute('aria-checked', 'false');
                                }
                            });
                            selectAllButton.classList.toggle('active', !isSelectAllActive);
                            selectAllButton.setAttribute('aria-checked', !isSelectAllActive);
                        } else { // 개별 필터 버튼 클릭 시
                            button.classList.toggle('active');
                            const isActive = button.classList.contains('active');
                            button.setAttribute('aria-checked', isActive);

                            if (isActive) {
                                selectedFilters[category].push(value);
                            } else {
                                selectedFilters[category] = selectedFilters[category].filter(item => item !== value);
                            }

                            // 모든 개별 필터가 선택되었는지 확인하여 '전체 선택' 버튼 상태 업데이트
                            const allIndividualSelected = uniqueValues.every(val => selectedFilters[category].includes(val));
                            selectAllButton.classList.toggle('active', allIndividualSelected);
                            selectAllButton.setAttribute('aria-checked', allIndividualSelected);
                        }
                        updateDashboard();
                        updateCurrentFiltersDisplay();
                    });
                    filterButtonsContainer.appendChild(button);
                });

                // 초기 로드 시 '전체 선택' 버튼 상태 업데이트
                const allIndividualSelected = uniqueValues.every(val => selectedFilters[category].includes(val));
                selectAllButton.classList.toggle('active', allIndividualSelected);
                selectAllButton.setAttribute('aria-checked', allIndividualSelected);
            }
            updateCurrentFiltersDisplay(); // 필터 버튼 초기화 후 현재 선택된 필터 표시 업데이트
        }

        // 아코디언 토글 기능
        function initializeAccordion() {
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const item = header.closest('.accordion-item');
                    const content = item.querySelector('.accordion-content');
                    const isExpanded = header.getAttribute('aria-expanded') === 'true';

                    // 모든 다른 아코디언 닫기 (선택사항 - 한 번에 하나만 열리게 하려면)
                    // document.querySelectorAll('.accordion-item').forEach(otherItem => {
                    //     if (otherItem !== item) {
                    //         const otherHeader = otherItem.querySelector('.accordion-header');
                    //         const otherContent = otherItem.querySelector('.accordion-content');
                    //         otherHeader.setAttribute('aria-expanded', 'false');
                    //         otherContent.style.maxHeight = '0';
                    //     }
                    // });

                    // 현재 아코디언 토글
                    header.setAttribute('aria-expanded', !isExpanded);
                    item.setAttribute('aria-expanded', !isExpanded);
                    
                    if (!isExpanded) {
                        content.style.maxHeight = content.scrollHeight + 'px';
                        content.style.opacity = '1';
                        content.style.padding = '0 15px 15px 15px';
                    } else {
                        content.style.maxHeight = '0';
                        content.style.opacity = '0';
                        content.style.padding = '0 15px';
                    }
                });
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            loadData();
            initializeAccordion();
            initializeFilters(); // 데이터 로드 및 아코디언 초기화 후 필터 초기화
        });



        document.querySelectorAll(".chart-type-selector").forEach(selector => {
            selector.addEventListener("change", (event) => {
                const chartId = event.target.id.replace("-chart-type", "");
                chartConfigs[chartId].type = event.target.value;
                
                // 필터링된 데이터 가져오기
                const filteredData = applyFilters(allData);
                
                // 해당 차트만 다시 그리기
                if (chartId === "yearChart") {
                    updateYearChart(filteredData);
                } else if (chartId === "gradeChart") {
                    updateGradeChart(filteredData);
                } else if (chartId === "regionChart") {
                    updateRegionChart(filteredData);
                } else if (chartId === "genderAgeChart") {
                    updateGenderAgeChart(filteredData);
                }
            });
        });
        });ebar-toggle-btn").addEventListener("click", () => {
            document.querySelector(".sidebar").classList.toggle("active");
        });

        // 고대비 모드 토글
        document.getElementById("contrast-toggle-btn").addEventListener("click", () => {
            document.body.classList.toggle("high-contrast");
        });

        // 데이터 내보내기 기능
        document.getElementById('export-data-btn').addEventListener('click', () => {
            const filteredData = applyFilters(allData);
            if (filteredData.length === 0) {
                alert('내보낼 데이터가 없습니다. 필터를 조정해주세요.');
                return;
            }

            const ws = XLSX.utils.json_to_sheet(filteredData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "청소년지도사 자격증 현황");
            XLSX.writeFile(wb, "청소년지도사_자격증_현황_필터링.xlsx");
            alert('데이터가 성공적으로 내보내졌습니다!');
        });

    </script>
</body>
</html>

